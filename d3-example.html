<!DOCTYPE html>
<html>
    <head>
      <title>Rigid body - Physijs</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
      <style type="text/css">
        svg {
          background-color: blue;
          margin: 10px;
        }
        circle {
          fill: tomato;
          opacity: .7;
        }
      </style>
    </head>
    <body>
      <div id="viewport"></div>
      <script type="text/javascript" src="lib/three.js"></script>
      <script type="text/javascript" src="lib/physi.js"></script>
      <script type="text/javascript" src="lib/CSS3DRenderer.js"></script>
      <script type="text/javascript" src="lib/d3.min.js"></script>
      <script type="text/javascript">
        var data = d3.range(10);

        // Physijs.PlaneMesh
        Physijs.CSS3DPlane = function ( geometry, material, mass ) {
            var width, height;

            Physijs.Mesh.call( this, geometry, material, mass );

            if ( !geometry.boundingBox ) {
                geometry.computeBoundingBox();
            }

            width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;
            height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;

            this._physijs.type = 'plane';
            this._physijs.normal = geometry.faces[0].normal.clone();
            this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;
        };
        Physijs.PlaneMesh.prototype = new Physijs.Mesh;
        Physijs.PlaneMesh.prototype.constructor = Physijs.PlaneMesh;


        Physijs.scripts.worker = 'lib/physijs_worker.js';
        Physijs.scripts.ammo = 'ammo.js';

        var scene = new Physijs.Scene;
            scene.setGravity(new THREE.Vector3(0, -50, 0));

        console.log(data);

        var container = d3.select("#viewport");

        container.selectAll(".chart")
          .data(data).enter()
            .append("svg")
              .attr("class", "chart")
              .attr("height", "100px")
              .attr("width", "100px")
              .attr("id", function (d) { return "chart-" + d; })
              .each(function () {
                d3.select(this).append("circle")
                  .attr("r", function (d) { return d * 5; })
                  .attr("cx", 50)
                  .attr("cy", 50)
              })
              .each(setData)
              .each(createCSS3D)

        console.log(scene);

        function setData (d) {
          var obj = {value: d};
          var random = new THREE.Object3D();
          random.position.x = Math.random() * 4000 - 2000;
          random.position.y = Math.random() * 4000 - 2000;
          random.position.z = Math.random() * 4000 - 2000;
          obj['random'] = random;

          d3.select(this).datum(obj);
        }

        function createCSS3D(d) {
          var object = new Physijs.CSS3DPlane(this);
          object.position = d.random.position;
          console.log(this.getBBox())
          scene.add(object);
        }

      </script>
    </body>

</html>